<!DOCTYPE html>
<html><head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Groovy DSL</title>
    <meta name="description" content="The power of Groovy for DSL and User Interaction in this presentation">
    <meta name="author" content="Corinne Krych, Sebastien Blanc, Fabrice Matrat">
    <link rel="shortcut icon" href="img/icon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/grails.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/grails.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/grails.png">
    <link rel="apple-touch-icon-precomposed" href="img/grails.png">
    <link rel="stylesheet" href="css/codemirror.css">
    <link rel="stylesheet" href="css/eclipse.css">
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <link href="css/jqcloud.css" rel="stylesheet">
    <link href="css/prez.css" media="all" rel="stylesheet">
</head>
<body>
<div id="header" >
    <div style="float:left">
        <a href="http://groovy.codehaus.org">
            <table><tr><td style="vertical-align:middle;"><img  src="img/turtle1.png" style="height:35px"/></td><td > </td></tr></table>
        </a>
    </div>
    <div style="display: inline-block; margin:0 auto;">
        <a id="currentTitle" style="font-size:20px;" href="https://github.com/corinnekrych/Gr8ConfUS">Groovy DSL for Kids</a>
    </div>
    <div style="float:right">
        <a href="http://grails.org">
            <table><tr><td style="vertical-align: middle; "> </td><td><img src="img/turtle2.png" style="height:35px"/></td></tr></table>
        </a>
    </div>
</div>
<div  id="wrapper">
<ul>
<li class="slide"  title="">

    <div class="container-narrow">
        <hr>

        <div class="jumbotron" style="font-family: fantasy">
            <h1>Embedded DSL:<br/><br/> Groovy and Scala Fair Duel</h1>
        </div>

        <hr>
        <div class="row-fluid marketing">
            <div class="span2">&nbsp;</div>
            <div class="span4">
                <p><img width="35%" src="img/corinne_krych.png"/></p>
                <h4>Corinne Krych</h4>
            </div>

            <div class="span4">
                <p><img width="35%" src="img/freeBSD.png"/></p>
                <h4>Pascal Cohen</h4>
            </div>
            <div class="span2">&nbsp;</div>
        </div>
        <hr>

        <div class="jumbotron">
            <p>to run this presentation: be full screen </p>
            <p>to submit the editor code to Grails app: ctrl S (command S on Mac)</p>
            <p>be careful using 1,2,3... it makes code snippet appears in the editor(focus must be inside editor)</p>
        </div>
        <hr>
        <div>
            <p style=""><img width="15%" src="img/j1.png"/></p>
        </div>

        <canvas id="animationcanvas" width="1000" height="1000" ></canvas>
        <code style="visibility: hidden;" id="animationcontent" class="language-javascript">var f = true;
            function animate() { f = !f;
            moveObject('franklin', {
            role: 'turtle1', y: 9,
            x: f ? 8 : 1,
            rotation: 0
            }, animate);

            }
            animate();</pre></code>

        <script>
            (function () {
                var canvas = document.getElementById('animationcanvas');
                var ctx = canvas.getContext('2d');
                var grid = 10;
                ctx.scale(canvas.width / grid, canvas.height / grid);
                ctx.translate(1/2, 1/2);

                function drawGrid() {
                    for (var i = 0; i < grid; i++) {
                        for (var j = 0; j < grid; j++) {
                            ctx.beginPath();
                            ctx.lineWidth = 0.01;
                            ctx.strokeStyle = 'green';
                            ctx.moveTo(i, 0);
                            ctx.lineTo(i, grid - 1);
                            ctx.moveTo(0, j);
                            ctx.lineTo(grid - 1, j);
                            ctx.stroke();
                        }
                    }
                }

                var images = {};
                function draw(place) {
                    if (!images[place.role]) {
                        images[place.role] = new Image();
                        images[place.role].src = 'img/' + place.role + '.png';
                    }
                    ctx.save();
                    ctx.translate(place.x, grid - 1 - place.y);
                    ctx.rotate(- place.rotation);
                    ctx.drawImage(images[place.role], -1/2, -1/2, 1, 1);
                    ctx.restore();
                }

                function average(from, to, progress) {
                    return from + (to - from) * progress;
                }

                var duration = 7000;
                var current = {};
                var animated = {};
                function animate() {
                    var name;
                    var cont = false;
                    ctx.clearRect(-1, -1, grid + 1, grid + 1);
                    //drawGrid();
                    for (name in animated) {
                        if (animated.hasOwnProperty(name)) {
                            var to = animated[name];
                            var from = current[name];
                            var progress = (Date.now() - to.startTime) / duration;
                            if (progress > 1) {
                                current[name] = {
                                    role: to.role,
                                    x: to.x,
                                    y: to.y,
                                    rotation: to.rotation
                                };
                                delete animated[name];
                                if (to.cb) {
                                    to.cb();
                                }
                            } else {
                                cont = true;
                                draw({
                                    role: to.role,
                                    x: average(from.x, to.x, progress),
                                    y: average(from.y, to.y, progress),
                                    rotation: average(from.rotation, to.rotation, progress)
                                });
                            }
                        }
                    }
                    for (name in current) {
                        if (current.hasOwnProperty(name) && !animated[name]) {
                            draw(current[name]);
                        }
                    }
                    if (cont) {
                        setTimeout(animate, 1000 / 60);
                    }
                }

                function moveObject(name, object, callback) {
                    if (!current[name]) {
                        current[name] = object;
                        animate();
                        callback();
                    } else {
                        object.startTime = Date.now();
                        object.cb = callback;
                        animated[name] = object;
                        animate();
                    }
                }
                eval('(function() {' + document.getElementById('animationcontent').innerHTML + '}())');
            })();
        </script>

    </div>
</li>

<li class="slide" title="Corinne">
    <div class="container-narrow">
        <hr>

        <div class="jumbotron">
            <h1>Ladies first : Corinne</h1><br/>
            <img width="20%" src="img/corinne_krych.png"/><br/>
        </div>

        <hr>

        <div class="row-fluid marketing">
            <div class="span4">
                <a href="https://twitter.com/corinnekrych"><img src="img/twitter.png" /></a>
                <h4>@corinnekrych</h4>
            </div>
            <div class="span4">
                <a href="https://github.com/corinnekrych"><img src="img/github.png"/></a>
                <h4>https://github.com/corinnekrych</h4>
            </div>
            <div class="span4">
                <a href="mailto:corinnekrych@gmail.com"><img width="24px" src="img/gmail.png" ></a>
                <h4>corinnekrych@gmail.com</h4>
            </div>
        </div>

        <br/>
        <div style="float: left; font-size: 25px; text-align: left; display: inline-block; width: 16%">
            <img src="img/rivierargug.png" width="100%"/>
        </div>
        <div style="float:left;text-align:left;display:inline-block;width: 16%">
            <img src="img/3musket33rs.jpeg" width="100%"/>
        </div>

        <div style="float: left; font-size: 25px; text-align: left; display: inline-block; width: 16%">
            <img src="img/js-sophia-small.png" width="100%"/>
        </div>

        <div style="float: right; font-size: 25px; text-align: left; display: inline-block; width: 16%">
            <img src="img/logo_duchess_all_in_one_small.png" width="100%"/>
        </div>
        <div style="float:right;text-align:right;display:inline-block;width: 16%">
            <img src="img/aerogear.png" width="100%"/>
        </div>
        <div style="float:right;text-align:right;display:inline-block;width: 16%">
            <img src="img/redhat-logo-cloud.jpeg" width="90%"/>
        </div>
    </div>
</li>

<li class="slide" title="Pascal">
    <div class="container-narrow">
        <hr>

        <div class="jumbotron">
            <h1>Pascal : my geek friend</h1><br/>
            <img width="20%" src="img/freeBSD.png"/><br/>
        </div>

        <hr>

        <div class="row-fluid marketing">
            <div class="span4">
                <a href="https://twitter.com/PascalCohen"><img src="img/twitter.png" /></a>
                <h4>@PascalCohen</h4>
            </div>
            <div class="span4">
                <a href="https://github.com/pascohent"><img src="img/github.png"/></a>
                <h4>https://github.com/pascohen</h4>
            </div>
            <div class="span4">
                <a href="mailto:pascohen@gmail.com"><img width="24px" src="img/gmail.png" ></a>
                <h4>pascohen@gmail.com</h4>
            </div>
        </div>
        <br/>
        <div style="width: 100%">
            <div style="float:left;text-align:right;display:inline-block;width: 30%">
                <img src="img/a.png" width="50%"/>
            </div>
            <div style="float:left;text-align:right;display:inline-block;width: 10%">
                &nbsp;
            </div>
            <div style="float: left; font-size: 25px; text-align: left; display: inline-block; width: 30%">
                <img src="img/rivierargug.png" width="50%"/>
            </div>
            <div style="float: left; font-size: 25px; text-align: left; display: inline-block; width: 30%">
                <img src="img/Lambda.svg" width="50%"/>
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Coming from...">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <h1>Kids <b>DSL</b>?</h1><br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span12">
                <h1>From</h1><br/>
                <div style="float: left; font-size: 25px; text-align: center; display: inline-block; width: 50%">
                    <img src="img/grails48.jpg" width="80%"/>
                </div>
                <div style="float: left; font-size: 25px; text-align: center; display: inline-block; width: 50%">
                    <img src="img/amadeus.jpg" width="80%"/>
                </div>
            </div>
        </div>
        <div class="jumbotron">
            <h1>To Kissing Turtles</h1><br/>
            <div style="float: left; font-size: 25px; text-align: center; display: inline-block; width: 50%">
                <img src="img/turtle1.png" width="40%"/>
            </div>
            <div style="float: left; font-size: 25px; text-align: center; display: inline-block; width: 50%">
                <img src="img/turtle2.png" width="40%"/>
            </div>
        </div>
    </div>
</li>

<li class="slide" title="DSL Definition">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <h1>WHAT IS A <b>DSL</b>?</h1><br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <p style="line-height: 150%;font-size: 35px"><strong>Domain-specific language</strong> (noun)</p>
                <p style="line-height: 150%;font-size: 30px" >a computer programming language of limited expressiveness focused on a particular domain</p>
                <h3>- Martin Fowler</h3>
            </div>
            <div class="span2">
            </div>
        </div-->
        <!--<div class="row-fluid marketing">-->
            <!--<div class="span2">-->
            <!--</div>-->
            <!--<div class="span8">-->
                <!--<p style="line-height: 150%;font-size: 30px" >a language offering expressive power focused on a particular problem domain, such as a specific class of applications or application aspect</p>-->
                <!--<h3>- Czarnecki Krzysztof </h3>-->
            <!--</div>-->
            <!--<div class="span2">-->
            <!--</div>-->
        <!--</div>-->
    </div>
</li>

<li class="slide" title="Computer Language">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <pre style="font-size:16px;text-align:justify">
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
            </pre>
        </div>
        <hr>
    </div>
</li>

<li class="slide" title="Computer Programming Language">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                    <pre class="code" style="line-height: 150%;font-size: 25px">
    <b class="code-color">SELECT</b> Bride
    <b class="code-color">FROM</b> SingleWomen
    <b class="code-color">WHERE</b> FatherInLaw = 'Millionaire'
    <b class="code-color">AND</b> Count(Car) > 20

    <b class="code-color">SELECT</b> Cash, Car, BankBalance
    <b class="code-color">FROM</b> FatherInLaw

    <b class="code-color">UPDATE</b> MyBankAccout
    <b class="code-color">SET</b> MyBal = MyBal + FatherInLawBal

    <b class="code-color">INSERT INTO</b> MyCarShed
    <b class="code-color">VALUES</b>('BMW')
                    </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Rubik Cube">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <img style="width:15%" src="img/cube_of_rubik_1.png"><br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <h1>RR U F B' RR F' B U RR</h1>
                    <pre class="code">
                    Terminology
                        F = front face
                        B = back face
                        R = right face
                        L = left face
                        U = up face
                        D = down face
                        A letter by itself means turn that face 90 degrees clockwise (eg. F)
                        A letter followed by an apostrophe means turn that face 90 degrees anti-clockwise (eg. F')
                    </pre>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Limited vs Expressiveness">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <h1>Limited or expressive?</h1><br/>
        </div>
        <hr>

        <div class="row-fluid marketing">
        <div class="span2">
        </div>
        <div class="span8">
        <p style="line-height: 150%;font-size: 30px" >a language offering <strong>expressive power</strong> focused on a particular problem domain, such as a specific class of applications or application aspect</p>
        <h3>- Czarnecki Krzysztof </h3>
        </div>
        <div class="span2">
        </div>
        </div>
    </div>
</li>

<li class="slide" title="Boundaries">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <br/>
            <h1 class="blur">Boundaries are blurry</h1><br/>
            <br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span4">
                <h1>Mini Language</h1>
                <hr>
                <pre class="code">prepare cake for tea</pre>
                <hr>
            </div>
            <div class="span4">
                <h1>Scripting</h1>
                <hr>
                <div> </div>
                <pre class="code">['cake', 'smoothie'].each{eat it}</pre>
                <hr>
            </div>
            <div class="span4">
                <h1>Fluent API</h1>
                <hr>
                <pre class="code">tea.willBe 45.minutes.from.now</pre>
                <hr>
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Ext. vs int.">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <br/>
            <h1 >External vs Internal DSL</h1><br/>
            <br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span6">
                <h1>External</h1>
                <img width="97%" src="img/pix.jpeg">
            </div>
            <div class="span6">
                <h1>Internal</h1>
                <pre style="text-align: left;white-space: pre;font-size: 16px">
<b style="color:#AF956F;">class</b> HelloSpock <b style="color:#AF956F;">extends</b> Specification {
 <b style="color:#AF956F;">def</b> <b style="color:#5D90CD;">"Spock's and his friends' names length"</b>() {
  expect:
   name.size() == length

   where:
    name     | length
    <b style="color:#5D90CD;">"Spock"</b>  | <b style="color:#46A609;">5</b>
    <b style="color:#5D90CD;">"Kirk"</b>   | <b style="color:#46A609;">4</b>
    <b style="color:#5D90CD;">"Scotty"</b> | <b style="color:#46A609;">6</b>
  }
}
                </pre>
            </div>
        </div>
    </div>
</li>
<li class="slide" style="display: inline-block; margin:0 auto;" title="Groovy" timing="7000">
    <div class="span8"  id="wordcloud">
    </div>
</li>

<li class="slide" title="DSL & Game">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <br/>
            <h1>Game rules & DSL</h1><br/>
            <br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span6">
                <h1>User1: Franklin</h1>
                <hr>
                <pre class="code">move left by 2.steps
move up by 3.steps
</pre>
                <hr>
            </div>
            <div class="span6">
                <h1>User2: Emily</h1>
                <hr>
                <div> </div>
                <pre class="code">move left by 2.steps
ask "What's is your name?" assign to name
</pre>
                <hr>
            </div>

        </div>
    </div>
</li>


<li class="slide" title="Script">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <h1>To start with: <br/>How to run Script?</h1><br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span4">
                <h3>Groovy</h3>
<pre class="code">def shell = new GroovyShell()
</pre>
            </div>
            <p>Each script is an object inheriting from Script base class</p>
            <div class="span4">
                <h3>Scala with Grails</h3>
                <pre class="code">object HelloWorld2 extends Application {
  println("Hello, world!")
}
</pre>
                <h3>Scala with Grails</h3>
                <p>// Two next steps necessary only inside Grails/Groovy
                    val env = new Settings()
                    env.usejavacp.value = true</p>
            </div>
            <!-- http://scabl.blogspot.fr/2013/05/scripting-with-scala-and-sbt.html -->
            <div class="span2">
            </div>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <h3>JSR 223</h3>
                <p>on its way tos td scripting usage.....</p>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!------------------------------------------------------------------->
<!-- Groovy1. Script
<!-- step 1 define base class
<!-- step 2 remove move definition in script
<!------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="Groovy Script" press="1 2 3 4">
    <textarea id="editorGroovy1" name="editorGroovy1">
// Configure the GroovyShell.
def shell = new GroovyShell()

///////////////////////
def gameDSL = '''
    println "I run a Groovy script"
'''
//////////////////////
// Run DSL script.
def result = shell.evaluate gameDSL</textarea>
</li>

<li class="slide" style="text-align: left" title="Run Groovy Script">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="output" id="outputGroovy1">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!------------------------------------------------------------------->
<!-- Scala1. Script
<!-- step 1 define base class
<!-- step 2 remove move definition in script
<!------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="Scala Script" press="1 2 3">
    <textarea id="editorScala1" name="editorScala1">import scala.tools.nsc._
import scala.tools.nsc.interpreter._

// Two next steps necessary only inside Grails/Groovy
val env = new Settings()
env.usejavacp.value = true

val interpreter = new IMain(env)

val dsl = """
  println("I run a Scala script")
"""

val result = interpreter.eval(dsl)</textarea>
</li>

<li class="slide" style="text-align: left" title="Run Scala Script">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="output" id="outputScala1">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>


<li class="slide" title="Syntax Sugar" style="background-image:url('img/sugar.jpg');
background-repeat:no-repeat;background-attachment:fixed;
background-position:center;"  >
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <h1>How to write plain English with ( , ; ?<br/>Syntax Sugar</h1><br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span4">
                <h3>Groovy</h3>
<pre class="code"> move(left)
move left
</pre>

            <p>remove ;</p>
            <p>remove () when one parameter etc...</p>
            </div>
            <div class="span4">
                <h3>Scala</h3>
                <p>explain move.to(left) etc...</p>
                <!-- interesting article
                http://docs.codehaus.org/display/GroovyJSR/GEP+3+-+Command+Expression+based+DSL
                -->
            </div>
            <div class="span2">
            </div>
        </div>
        <hr>
    </div>
</li>

<!------------------------------------------------------------------->
<!-- Groovy2. Base Class
<!-- step 1 define base class
<!-- step 2 remove move definition in script
<!-- step 3 introduce compilerConfiguration
<!-- step 4 inject it in groovy shell
<!------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="Base class" press="1 2 3 4 5">
    <textarea id="editorGroovy2" name="editorGroovy2">
    </textarea>
</li>

<li class="slide" style="text-align: left" title="Output base class for Groovy">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="outputGroovy2">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!-------------------------------------------------------------------
Scala2. Binding for Scala
step 1 add binding
step 2 highlight val left="left"
step 3 remove line
------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="Binding in Scala" press="1 2 3">
    <textarea id="editorScala2" name="editorScala2">
    </textarea>
</li>

<li class="slide" style="text-align: left" title="Output binding for Scala">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="outputScala2">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>


<!-------------------------------------------------------------------
Groovy3. Binding
step 1 introduce right in binding
step 2 ad move right command
------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="Binding in Groovy" press="1 2">
    <textarea id="editorGroovy3" name="editorGroovy3">
    </textarea>
</li>

<li class="slide" style="text-align: left" title="Output binding for Groovy">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="outputGroovy3">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!------------------------------------------------------------------
Groovy4. Structure my code
step 1 add Position
step 2 add Driection enums
step 3 add turtle class
step 4 new Turtle()
step 5 highlight compilerconf + binding
step 6 inject binding,
step 7 remove def left in GameScript
------------------------------------------------------------------>
<li class="slide" style="text-align: left" title="Add Turtle in Groovy" press="1 2 3 4 5 6 7">
    <textarea id="editorGroovy4" name="editorGroovy4">
    </textarea>
</li>

<li class="slide" style="text-align: left" title="Output turtle position for Groovy">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="outputGroovy4">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!------------------------------------------------------------------
Scala4. Structure my code

------------------------------------------------------------------>
<li class="slide" style="text-align: left" title="Add Turtle in Scala" press="-">
    <textarea id="editorScala4" name="editorScala4">
    </textarea>
</li>

<li class="slide" style="text-align: left" title="Output turtle position for Scala">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="outputScala4">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!------------------------------------------------------------------->
<!-- Groovy5. Building JSON
<!-- step 1 use steps instead println
<!-- step 2 after eval get value of steps
<!-- step 3 jsonbuilder
<!-- step 4 up the stairs
<!-- cmd-S for text output cmd-D for canvas output
<!------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="Build JSON" press="1 2 3 4 5 6 7">
    <textarea id="editorGroovy5" name="editorGroovy5">
</textarea>
</li>

<li class="slide" style="text-align: left" title="Output for JSON in Groovy">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="outputGroovy5">
                </pre>
                <canvas id="canvasGroovy5" width="1000" height="1000" style="background-color: #f5f5f5;max-width: 500px; width: 100%;"></canvas>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!------------------------------------------------------------------
Scala5. Structure my code

------------------------------------------------------------------>
<li class="slide" style="text-align: left" title="Build JSON in Scala" press="-">
    <textarea id="editorScala5" name="editorScala5">
    </textarea>
</li>

<li class="slide" style="text-align: left" title="Output for JSON in Scala">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="outputScala5">
                </pre>
                <canvas id="canvasScala5" width="1000" height="1000" style="background-color: #f5f5f5;max-width: 500px; width: 100%;"></canvas>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!------------------------------------------------------------------->
<!-- slide command chaining
<!------------------------------------------------------------------->
<li class="slide" title="Command Chaining">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <br/>
            <h1>Command chaining</h1><br/>
            <br/>
        </div>
        <hr>
    </div>
    <div class="row-fluid marketing">
        <div class="span2">
        </div>
        <div class="span8">
            <p style="line-height:150%; font-size:25px;font-style:italic"><strong>Method chaining</strong> is a common technique for invoking multiple method calls in object-oriented programming languages. Each method returns an object (possibly the current object itself), allowing the calls to be chained together in a single statement.</p>
            <div style="line-height:150%; font-size:20px;" class="general quote-author">- wikipedia</div>
        </div>
        <div class="span2">
        </div>
    </div>
    <div class="row-fluid marketing">
        <div class="span1">
        </div>
        <div class="span5">
            <hr>
            <div style="line-height:150%;font-size:25px;text-align:left;">
                <div style="color:grey"> move left</div>
                <div>    => move(left)</div>
            </div>
            <hr>
        </div>
        <div class="span5">
            <hr>
            <div style="line-height:150%;font-size:25px;text-align:left;">
                <div style="color:grey">move left by 2</div>
                <div>    => move(left).by(2)</div>
            </div>
            <hr>
        </div>
        <div class="span1">
        </div>
    </div>
</li>

<!-------------------------------------------------------------------
6. Command chaining odd number
step 1: highlight dsl syntax
step 2: move left by 2
step 3: add by method
step 4: highlight steps.add from turtle move
step 5: remove steps.add from turtle mve
step 6: add steps.add to turtle by
step 7: change new Position to add direction
------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="Command Chaining" press="Press 1..7">
    <textarea id="editorGroovy6" name="editorGroovy6">
class Position {
  int x
  int y
  Direction direction
  Position left() {
     new Position(x, y, Direction.left);
  }
  Position right() {
    new Position(x, y, Direction.right);
  }
  Position up() {
    new Position(x , y, Direction.up);
  }
  Position down() {
    new Position(x , y, Direction.down);
  }
  def Position(moveX, moveY, myDirection) {
    x = moveX
    y = moveY
    direction = myDirection
  }
  Position move(Integer step) {
    Position newPosition
    if(direction == Direction.left) {
      newPosition = new Position(x - step, y, direction)
    } else if(direction == Direction.right) {
      newPosition = new Position(x + step, y, direction)
    } else if(direction == Direction.up) {
      newPosition = new Position(x, y + step, direction)
    } else if(direction == Direction.down) {
      newPosition = new Position(x, y - step, direction)
    }
  }
}

class Turtle {
   def currentPosition
   def steps = []
   Turtle(Position start) {
      currentPosition = start
      steps.add(start)
   }

   Turtle move(Direction dir) {
      Position newPosition
      if (dir == Direction.left) {
        newPosition = currentPosition.left()
      } else if (dir == Direction.right) {
        newPosition = currentPosition.right()
      } else if (dir == Direction.up) {
        newPosition = currentPosition.up()
      } else if (dir == Direction.down) {
        newPosition = currentPosition.down()
      }
      currentPosition = newPosition
      steps.add(newPosition)
      this
   }

}
enum Direction {
  left, right, up, down
}


def turtle = new Turtle(new Position(1, 1))
def compilerConfig = new CompilerConfiguration()
def binding = new Binding([turtle: turtle,
  						   move: turtle.&move,
                           left: Direction.left,
                           right: Direction.right,
                           up: Direction.up,
                           down: Direction.down])
def shell = new GroovyShell(this.class.classLoader,
        binding,
        compilerConfig)
///////////////////////
def gameDSL = '''
2.times {
  move right
  move up
}
'''
//////////////////////
// Run DSL script.
// result contains turtle object
// with all steps
shell.evaluate gameDSL
def builder = new groovy.json.JsonBuilder()
builder {
   steps binding["turtle"].steps
}
println builder
builder.toString()
    </textarea>
</li>


<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="outputGroovy6">
                </pre>
                <canvas id="canvasGroovy6" width="1000" height="1000" style="max-width: 500px; width: 100%;"></canvas>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>
<!------------------------------------------------------------------->
<!-- slide Back to command chaining
<!------------------------------------------------------------------->
<li class="slide" title="Back to Command Chaining">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <br/>
            <h1>Command chaining</h1><br/>
            <br/>
        </div>
        <hr>
    </div>

    <div class="row-fluid marketing">
        <div class="span1">
        </div>
        <div class="span5">
            <hr>
            <div style="line-height:150%;font-size:25px;text-align:left;">
                <div style="color:grey"> move left by 2</div>
                <div>    => move(left).by(2)</div>
            </div>
            <hr>
        </div>
        <div class="span5">
            <hr>
            <div style="line-height:150%;font-size:25px;text-align:left;">
                <div style="color:grey"> move left by 2 steps</div>
                <div>    => move(left).by(2).steps</div>
            </div>
            <hr>
        </div>
        <div class="span1">
        </div>
    </div>
</li>
<!-------------------------------------------------------------------
6b. Command chaining odd number
step 1: highlight dsl syntax
step 2: move left by 2 steps
step 3: highlight by method
step 4: change by method to return map
------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="Odd Command Chaining" press="Press 1..4">
    <textarea id="editorGroovy6b" name="editorGroovy6b">
class Position {
  int x
  int y
  Direction direction
  Position left() {
     new Position(x, y, Direction.left);
  }
  Position right() {
    new Position(x, y, Direction.right);
  }
  Position up() {
    new Position(x , y, Direction.up);
  }
  Position down() {
    new Position(x , y, Direction.down);
  }
  def Position(moveX, moveY, myDirection) {
    x = moveX
    y = moveY
    direction = myDirection
  }
  Position move(Integer step) {
    Position newPosition
    if(direction == Direction.left) {
      newPosition = new Position(x - step, y, direction)
    } else if(direction == Direction.right) {
      newPosition = new Position(x + step, y, direction)
    } else if(direction == Direction.up) {
      newPosition = new Position(x, y + step, direction)
    } else if(direction == Direction.down) {
      newPosition = new Position(x, y - step, direction)
    }
  }
}

class Turtle {
   def currentPosition
   def steps = []
   Turtle(Position start) {
      currentPosition = start
      steps.add(start)
   }

   Turtle move(Direction dir) {
      Position newPosition
      if (dir == Direction.left) {
        newPosition = currentPosition.left()
      } else if (dir == Direction.right) {
        newPosition = currentPosition.right()
      } else if (dir == Direction.up) {
        newPosition = currentPosition.up()
      } else if (dir == Direction.down) {
        newPosition = currentPosition.down()
      }
      currentPosition = newPosition
      this
   }

  Turtle by (Integer step) {
    Position newPosition = currentPosition.move(step)
    steps.add(newPosition)
    currentPosition = newPosition
    steps.add(newPosition)
    this
  }
}
enum Direction {
  left, right, up, down
}

def turtle = new Turtle(new Position(1, 1, Direction.left))
def compilerConfig = new CompilerConfiguration()
def binding = new Binding([turtle: turtle,
  						   move: turtle.&move,
                           left: Direction.left,
                           right: Direction.right,
                           up: Direction.up,
                           down: Direction.down])
def shell = new GroovyShell(this.class.classLoader,
        binding,
        compilerConfig)
///////////////////////
def gameDSL = '''
2.times {
    move right by 2
    move up by 1
}
'''
//////////////////////
// Run DSL script.
// result contains turtle object
// with all steps
shell.evaluate gameDSL
def builder = new groovy.json.JsonBuilder()
builder {
   steps binding["turtle"].steps
}
println builder
builder.toString()
    </textarea>
</li>


<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="outputGroovy6b">
                </pre>
                <canvas id="canvasGroovy6b" width="1000" height="1000" style="max-width: 500px; width: 100%;"></canvas>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!-------------------------------------------------------------------
7. Adding behavior to Integer
step1: highlight dsl
step2: move left by 2.steps
step3: add class StepCategory
step4: highlight shell.eval
step5: modify shell.eval with use()
step6: highlight class StepCategory
step7: replace with @Category annotation
------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="Adding behavior to Integer" press="Press 1..7">
    <textarea id="editorGroovy7" name="editorGroovy7">
class Position {
  int x
  int y
  Direction direction
  Position left() {
     new Position(x, y, Direction.left);
  }
  Position right() {
    new Position(x, y, Direction.right);
  }
  Position up() {
    new Position(x , y, Direction.up);
  }
  Position down() {
    new Position(x , y, Direction.down);
  }
  def Position(moveX, moveY, myDirection) {
    x = moveX
    y = moveY
    direction = myDirection
  }
  Position move(Integer step) {
    Position newPosition
    if(direction == Direction.left) {
      newPosition = new Position(x - step, y, direction)
    } else if(direction == Direction.right) {
      newPosition = new Position(x + step, y, direction)
    } else if(direction == Direction.up) {
      newPosition = new Position(x, y + step, direction)
    } else if(direction == Direction.down) {
      newPosition = new Position(x, y - step, direction)
    }
  }
}

class Turtle {
  def currentPosition
  def steps = []
  Turtle(Position start) {
    currentPosition = start
    steps.add(start)
  }

  Turtle move(Direction dir) {
    Position newPosition
    if (dir == Direction.left) {
      newPosition = currentPosition.left()
    } else if (dir == Direction.right) {
      newPosition = currentPosition.right()
    } else if (dir == Direction.up) {
      newPosition = currentPosition.up()
    } else if (dir == Direction.down) {
      newPosition = currentPosition.down()
    }
    currentPosition = newPosition
    this
  }

  Turtle by (Integer step) {
    Position newPosition = currentPosition.move(step)
    steps.add(newPosition)
    currentPosition = newPosition
    this
  }
}
enum Direction {
  left, right, up, down
}


def turtle = new Turtle(new Position(1, 1, Direction.left))
def compilerConfig = new CompilerConfiguration()
def binding = new Binding([turtle: turtle,
  						   move: turtle.&move,
                           left: Direction.left,
                           right: Direction.right,
                           up: Direction.up,
                           down: Direction.down])
def shell = new GroovyShell(this.class.classLoader,
        binding,
        compilerConfig)
///////////////////////
def gameDSL = '''
2.times {
  move right by 2
  move up by 1
}
'''
//////////////////////
// Run DSL script.
// result contains turtle object
// with all steps
shell.evaluate gameDSL
def builder = new groovy.json.JsonBuilder()
builder {
   steps binding["turtle"].steps
}
println builder
builder.toString()

    </textarea>
</li>


<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="outputGroovy7">
                </pre>
                <canvas id="canvasGroovy7" width="1000" height="1000" style="max-width: 500px; width: 100%;"></canvas>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!-------------------------------------------------------------------
8. TypeChecked
step 1: highlight compiler
step 2: add typechecked ext
<!------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="TypeChecked" press="Press 1..2">
    <textarea id="editorGroovy8" name="editorGroovy8">
class Position {
    int x
    int y
    Direction direction
    Position left() {
        new Position(x, y, Direction.left);
    }
    Position right() {
        new Position(x, y, Direction.right);
    }
    Position up() {
        new Position(x , y, Direction.up);
    }
    Position down() {
        new Position(x , y, Direction.down);
    }
    def Position(moveX, moveY, myDirection) {
        x = moveX
        y = moveY
        direction = myDirection
    }
    Position move(Integer step) {
        Position newPosition
        if(direction == Direction.left) {
            newPosition = new Position(x - step, y, direction)
        } else if(direction == Direction.right) {
            newPosition = new Position(x + step, y, direction)
        } else if(direction == Direction.up) {
            newPosition = new Position(x, y + step, direction)
        } else if(direction == Direction.down) {
            newPosition = new Position(x, y - step, direction)
        }
    }
}

class Turtle {
    def currentPosition
    def steps = []
    Turtle(Position start) {
        currentPosition = start
        steps.add(start)
    }

    Turtle move(Direction dir) {
        Position newPosition
        if (dir == Direction.left) {
            newPosition = currentPosition.left()
        } else if (dir == Direction.right) {
            newPosition = currentPosition.right()
        } else if (dir == Direction.up) {
            newPosition = currentPosition.up()
        } else if (dir == Direction.down) {
            newPosition = currentPosition.down()
        }
        currentPosition = newPosition
        this
    }

    Turtle by (Integer step) {
        Position newPosition = currentPosition.move(step)
        steps.add(newPosition)
        currentPosition = newPosition
        this
    }
}

enum Direction {
    left, right, up, down
}


def turtle = new Turtle(new Position(1, 1, Direction.left))

def binding = new Binding([turtle: turtle,
    move: turtle.&move,
    left: Direction.left,
    right: Direction.right,
    up: Direction.up,
    down: Direction.down])

def compilerConfig = new CompilerConfiguration()

def shell = new GroovyShell(this.class.classLoader,
    binding,
    compilerConfig)
///////////////////////
def gameDSL = '''
moooooooooove right by 2
move up by 3
'''
//////////////////////
// Run DSL script.
// result contains turtle object
// with all steps
shell.evaluate gameDSL

def builder = new groovy.json.JsonBuilder()
builder {
    steps binding["turtle"].steps
}
println builder
builder.toString()


    </textarea>
</li>


<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="outputGroovy8">
                </pre>
                <canvas id="canvasGroovy8" width="1000" height="1000" style="max-width: 500px; width: 100%;"></canvas>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!-------------------------------------------------------------------
9. Turn around
step1: highlight dsl
step2: modify dsl with infinite loop
step3: highlight ASTTransformationCustomizer
step4: add TimeInterrupt
------------------------------------------------------------------->

<li class="slide" style="text-align: left" title="Franklin wants to turn around" press="Press 1..4">
    <textarea id="editorGroovy9" name="editorGroovy9">
class Position {
    int x
    int y
    Direction direction
    Position left() {
        new Position(x, y, Direction.left);
    }
    Position right() {
        new Position(x, y, Direction.right);
    }
    Position up() {
        new Position(x , y, Direction.up);
    }
    Position down() {
        new Position(x , y, Direction.down);
    }
    def Position(moveX, moveY, myDirection) {
        x = moveX
        y = moveY
        direction = myDirection
    }
    Position move(Integer step) {
        Position newPosition
        if(direction == Direction.left) {
            newPosition = new Position(x - step, y, direction)
        } else if(direction == Direction.right) {
            newPosition = new Position(x + step, y, direction)
        } else if(direction == Direction.up) {
            newPosition = new Position(x, y + step, direction)
        } else if(direction == Direction.down) {
            newPosition = new Position(x, y - step, direction)
        }
    }
}

class Turtle {
    def currentPosition
    def steps = []
    Turtle(Position start) {
        currentPosition = start
        steps.add(start)
    }

    Turtle move(Direction dir) {
        Position newPosition
        if (dir == Direction.left) {
            newPosition = currentPosition.left()
        } else if (dir == Direction.right) {
            newPosition = currentPosition.right()
        } else if (dir == Direction.up) {
            newPosition = currentPosition.up()
        } else if (dir == Direction.down) {
            newPosition = currentPosition.down()
        }
        currentPosition = newPosition
        this
    }

    Turtle by (Integer step) {
        Position newPosition = currentPosition.move(step)
        steps.add(newPosition)
        currentPosition = newPosition
        this
    }
}

enum Direction {
    left, right, up, down
}


def turtle = new Turtle(new Position(1, 1, Direction.left))

def binding = new Binding([turtle: turtle,
    move: turtle.&move,
    left: Direction.left,
    right: Direction.right,
    up: Direction.up,
    down: Direction.down])

def compilerConfig = new CompilerConfiguration()

compilerConfig.addCompilationCustomizers(
    new ASTTransformationCustomizer(TypeChecked, extensions:['TurtleExtension.groovy']))

def shell = new GroovyShell(this.class.classLoader,
    binding,
    compilerConfig)
///////////////////////
def gameDSL = '''

    move right by 2
    move up by 2
    move right by 2
    move up by 2

'''
//////////////////////
// Run DSL script.
// result contains turtle object
// with all steps
shell.evaluate gameDSL

def builder = new groovy.json.JsonBuilder()
builder {
    steps binding["turtle"].steps
}
println builder
builder.toString()
    </textarea>
</li>

<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="outputGroovy9">
                </pre>
                <canvas id="canvasGroovy9" width="1000" height="1000" style="max-width: 500px; width: 100%;"></canvas>
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>


<!-------------------------------------------------------------------
10. Sneaky
step 1: highlight dsl
step 2: add system.exit
step 3: add SecureASTCustomizer
------------------------------------------------------------------->

<li class="slide" style="text-align: left" title="Franklin wants to play with fire" press="Press 1..3">
    <textarea id="editorGroovy10" name="editorGroovy10">
class Position {
    int x
    int y
    Direction direction
    Position left() {
        new Position(x, y, Direction.left);
    }
    Position right() {
        new Position(x, y, Direction.right);
    }
    Position up() {
        new Position(x , y, Direction.up);
    }
    Position down() {
        new Position(x , y, Direction.down);
    }
    def Position(moveX, moveY, myDirection) {
        x = moveX
        y = moveY
        direction = myDirection
    }
    Position move(Integer step) {
        Position newPosition
        if(direction == Direction.left) {
            newPosition = new Position(x - step, y, direction)
        } else if(direction == Direction.right) {
            newPosition = new Position(x + step, y, direction)
        } else if(direction == Direction.up) {
            newPosition = new Position(x, y + step, direction)
        } else if(direction == Direction.down) {
            newPosition = new Position(x, y - step, direction)
        }
    }
}

class Turtle {
    def currentPosition
    def steps = []
    Turtle(Position start) {
        currentPosition = start
        steps.add(start)
    }

    Turtle move(Direction dir) {
        Position newPosition
        if (dir == Direction.left) {
            newPosition = currentPosition.left()
        } else if (dir == Direction.right) {
            newPosition = currentPosition.right()
        } else if (dir == Direction.up) {
            newPosition = currentPosition.up()
        } else if (dir == Direction.down) {
            newPosition = currentPosition.down()
        }
        currentPosition = newPosition
        this
    }

    Turtle by (Integer step) {
        Position newPosition = currentPosition.move(step)
        steps.add(newPosition)
        currentPosition = newPosition
        this
    }
}

enum Direction {
    left, right, up, down
}


def turtle = new Turtle(new Position(1, 1, Direction.left))

def binding = new Binding([turtle: turtle,
    move: turtle.&move,
    left: Direction.left,
    right: Direction.right,
    up: Direction.up,
    down: Direction.down])

def compilerConfig = new CompilerConfiguration()

def tc = new ASTTransformationCustomizer(TypeChecked, extensions:['TurtleExtension.groovy'])
def ti = new ASTTransformationCustomizer([value:5L], TimedInterrupt)

compilerConfig.addCompilationCustomizers(tc, ti)

def shell = new GroovyShell(this.class.classLoader,
    binding,
    compilerConfig)
///////////////////////
def gameDSL = '''
    move right by 2
    move up by 2
    move left by 2
    move down by 2

'''
//////////////////////
// Run DSL script.
// result contains turtle object
// with all steps
shell.evaluate gameDSL

def builder = new groovy.json.JsonBuilder()
builder {
    steps binding["turtle"].steps
}
println builder
builder.toString()
    </textarea>
</li>

<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="outputGroovy10">
                </pre>
                <canvas id="canvasGroovy10" width="1000" height="1000" style="max-width: 500px; width: 100%;"></canvas>
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>


<!-------------------------------------------------------------------
11.ask
step1: insert DSL ask
step2: add ask method
step3: add propertyMissingMethod
step4: add display map method
step5: add display map in DSL
------------------------------------------------------------------->

<li class="slide" style="text-align: left" title="Franklin wants to ask" press="Press 1..5">
    <textarea id="editorGroovy11" name="editorGroovy11">
abstract class GameScript extends Script {


}
def compilerConfig = new CompilerConfiguration()
compilerConfig.scriptBaseClass = GameScript.class.name
def binding = new Binding()
def shell = new GroovyShell(this.class.classLoader,
                            binding,
                            compilerConfig)
///////////////////////
def surveyDSL = '''

'''
//////////////////////
// Run DSL script.
shell.evaluate surveyDSL
    </textarea>
</li>

<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="output" id="outputGroovy11">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<li class="slide" title="DSL Sequence">
    <div class="row-fluid marketing">
        <div class="span12">
            <img src="img/ask and ast.png" width="80%"/>
        </div>
    </div>
</li>

<!------------------------------------------------------------------->
<!-- 12. AST for user transform
<!------------------------------------------------------------------->

<li class="slide" style="text-align: left" title="AST Tranformation" press="">
    <textarea id="editorGroovy12" name="editorGroovy12">
def getShell(binding) {
  def config = new CompilerConfiguration()
  config.addCompilationCustomizers(new SurveyCustomizer())
  config.scriptBaseClass = SurveyScript.name
  new GroovyShell(this.class.classLoader,
                  binding,
                  config)
}
def binding = new Binding()
def inputs = [:]
binding.setVariable("inputs", inputs)
def script = """
ask "what's your name?" assign to name
ask "what's your birthday?" assign to date
"""
//first evaluate should run only the first ask
getShell(binding).evaluate script
//second evaluate should run only the second ask2
getShell(binding).evaluate script


abstract class SurveyScript extends Script {
  def ask(question) {
    [assign : { to ->
      [:].withDefault {assignment ->
        inputs.question = question
        inputs.lastAssignment = assignment
        println "ask called\n --> counter: $inputs.counter \n" +
        "--> question: $question\n" +
        "--> variables: $inputs.lastAssignment\n" +
        "______________________________________\n"
        inputs.counter++
      }
    }]
  }

  def propertyMissing(String name) {
    name
  }

  //entry point method each time the script is called
  void dispatch() {
    if(!inputs.answerMap){
      inputs.answerMap = [:]
    }
    if(!inputs.counter){
      inputs.counter=0
    }
    inputs.answerMap[inputs.counter] =
      [variable:inputs.lastAssignment,
       question:inputs.question,
       answer:inputs.answer]
    invokeMethod()
  }

  def invokeMethod() {
    try {
      def method =
      this.class.getMethod("doStep_${inputs.counter}")
      method.invoke(this)
    }
    catch(NoSuchMethodException exp){
      inputs.finished = true
    }
  }
}

public class SurveyCustomizer extends CompilationCustomizer {
  def step = 0

  public SurveyCustomizer() {
    super(CompilePhase.CONVERSION);
  }

  @Override
  public void call(final SourceUnit source,
                   final GeneratorContext context,
                   final ClassNode classNode)
    throws CompilationFailedException {
    def methodCalls = []
    def ast = source.getAST();
    ast.classes.each {
      def myClassNode = it
      it.methods.each {
        if (it.code instanceof BlockStatement
          && it.name == "run") {
          it.code.statements.each {
            methodCalls << it
          }
          def result = new AstBuilder().buildFromCode {
            this.dispatch()
          }
          it.code = result[0];
        }
      }
      methodCalls.each {
        addStatement(it, myClassNode)
      }
    }
  }

  private def addStatement(ExpressionStatement exprStmt,
                           myClassNode) {
    BlockStatement methodCodeBlock = new BlockStatement()
    methodCodeBlock.addStatement(exprStmt)
    myClassNode.addMethod("doStep_" + step,
                          1,
                          null,
                          [] as Parameter[],
                          [] as ClassNode[],
                          methodCodeBlock)
    step++
  }
}
    </textarea>
</li>

<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="output" id="outputGroovy12">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>


<!------------------------------------------------------------------->
<!-- 12. References
<!------------------------------------------------------------------->

<li class="slide" title="References">
    <div class="container-narrow">
        <hr>

        <div style="text-align: center" class="jumbotron">
            <img width="20%" src="img/rivierargug.png"/><br/>
        </div>

        <hr>

        <div  class="row-fluid marketing">
            <div class="span1">
            </div>
            <div class="span5">
                <div style="line-height: 150%;font-size:30px;font-weight:bold">Like the presentation format?</div>
                <div id="technologies" style="line-height: 150%;font-size:30px;"></div>

                <div style="line-height: 150%;font-size:30px;font-weight:bold">Curious about code?</div>
                <a href="https://github.com/corinnekrych/DslPrez" style="line-height: 150%;font-size:20px;">https://github.com/corinnekrych/DslPrez</a>

                <div style="line-height: 150%;font-size:30px;font-weight:bold">Want to play with it?</div>
                <a href='https://github.com/corinnekrych/KissingTurtles' style="line-height: 150%;font-size:20px;">https://github.com/corinnekrych/KissingTurtles</a>
            </div>
            <div class="span5">
                <div style="line-height: 150%;font-size:30px;font-weight:bold">Special Thanks</div>
                <div style="line-height: 150%;font-size:20px;">Mathieu Bruyen, Sebastien Blanc, Fabrice Matrat</div>
                <div style="line-height: 150%;font-size:30px;font-weight:bold">References</div>
                <div style="line-height: 150%;font-size:20px;">Domain-Specific Languages</div>
                <div style="line-height: 150%;font-size:20px;font-style:italic">Martin Fowler, with Rebecca Parsons</div>
                <div style="line-height: 150%;font-size:20px;">Groovy for Domain-Specific Languages  </div>
                <div style="line-height: 150%;font-size:20px;font-style:italic">Fergal Dearle</div>
                <div style="line-height: 150%;font-size:20px;">Groovy in Action</div>
                <div style="line-height: 150%;font-size:20px;font-style:italic">Guillaume Laforge, Paul King, Jon Skeet </div>
            </div>
            <div class="span1">
            </div>
        </div>
    </div>
</li>

</ul>
</div>
<div id="footer">
    <div style="float:left;width:33%;">
        <a id="previous">
            <table><tr><td style="vertical-align:middle;"><img  src="img/previous.png" style="height:40px"/></td><td id="previous-title"> Previous</td></tr></table>
        </a>
    </div>
    <div style="display: inline-block; margin:0 auto;position:relative;top:10px; width:33%;">
        <a id="currentPress" style="font-size:20px;"></a>
    </div>
    <div style="float:right;width:33%;">
        <a id="next">
            <table style="float:right;"><tr><td id="next-title" style="vertical-align: middle; ">Next</td><td id="count"></td><td><img src="img/next.png" style="height:40px"/></td></tr></table>
        </a>
    </div>
</div>

<script src="js/jquery-1.9.1.min.js"></script>
<script src="js/codemirror.js"></script>
<script src="js/groovy.js"></script>

<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
<script src="js/html5.js">
</script>
<![endif]-->
<script src="js/bootstrap.js"></script>
<script src="js/editor.js"></script>
<script src="js/jquery.airport-1.1.source.js"></script>
<script src="js/jqcloud-1.0.4.min.js"></script>
<script src="js/prez.js"></script>
<script src="js/ktDraw.js"></script>
<script src="js/slide.js"></script>

<script>

    var showCloud = function() {
        var height = screen.height;
        var width = screen.width;
        var word_array = [
            {text: "syntax sugar", weight: 9},
            {text: "less punctuation", weight: 7},
            {text: "scripting", weight: 5},
            {text: "binding", weight: 7},
            {text: "no getter setter", weight: 1},
            {text: "map", weight: 7},
            {text: "named parameters", weight: 8},
            {text: "closure", weight: 6},
            {text: "GString", weight: 4},
            {text: "public visibility", weight: 2},
            {text: "return statement optional", weight: 3},
            {text: "groovy truth", weight: 7},
            {text: "operator overloading", weight: 1},
            {text: "GroovyMarkup", weight: 4},
            {text: "method pointer", weight: 6},
            {text: "runtime transformation", weight: 1},
            {text: "MOP", weight: 9},
            {text: "Expando", weight: 8},
            {text: "Categories", weight: 7},
            {text: "methodMissing", weight: 8},
            {text: "command chaining", weight: 1},
            {text: "compile time transformation", weight: 7},
            {text: "AST transformation", weight: 10},
            {text: "CST transformation", weight: 5},
            {text: "TypeChecked DSL", weight: 10}
        ];
        $("#wordcloud").empty();
        $("#wordcloud").jQCloud(word_array,{
            height: $(window).height()*0.7,
            width: $(window).width()*0.8
        });
    };

    var showGroovyDuke = function() {
        $('.CodeMirror').addClass("groovyduke");
        $(document.body).addClass("groovycolor");
    }
    var showScalaDuke = function() {
        $('.CodeMirror').addClass("scaladuke");
        $(document.body).addClass("scalacolor");
    }
    var removeGroovyDuke = function() {
        $('.CodeMirror').removeClass("groovyduke");
        $(document.body).removeClass("groovycolor");
    }
    var removeScalaDuke = function() {
        $('.CodeMirror').removeClass("scaladuke");
        $(document.body).removeClass("scalacolor");
    }
    var slide = new dslPrez.Slide();
    slide.enter("Groovy", showCloud);

    slide.enter("Groovy Script", showGroovyDuke, removeGroovyDuke);
    slide.enter("Run Groovy Script", showGroovyDuke, removeGroovyDuke);
    slide.enter("Scala Script", showScalaDuke, removeScalaDuke);
    slide.enter("Run Scala Script", showScalaDuke, removeScalaDuke);

    slide.enter("Base class", showGroovyDuke, removeGroovyDuke);
    slide.enter("Output base class for Groovy", showGroovyDuke, removeGroovyDuke);
    slide.enter("Binding in Scala", showScalaDuke, removeScalaDuke);
    slide.enter("Output binding for Scala", showScalaDuke, removeScalaDuke);

    slide.enter("Binding in Groovy", showGroovyDuke, removeGroovyDuke);
    slide.enter("Output binding for Groovy", showGroovyDuke, removeGroovyDuke);

    slide.enter("Add Turtle in Groovy", showGroovyDuke, removeGroovyDuke);
    slide.enter("Output turtle position for Groovy", showGroovyDuke, removeGroovyDuke);
    slide.enter("Add Turtle in Scala", showScalaDuke, removeScalaDuke);
    slide.enter("Output turtle position for Scala", showScalaDuke, removeScalaDuke);

    slide.enter("Build JSON", showGroovyDuke, removeGroovyDuke);
    slide.enter("Output for JSON in Groovy", showGroovyDuke, removeGroovyDuke);
    slide.enter("Build JSON in Scala", showScalaDuke, removeScalaDuke);
    slide.enter("Output for JSON in Scala", showScalaDuke, removeScalaDuke);

//    slide.enter("", showGroovyDuke, removeGroovyDuke);
//    slide.enter("Output for JSON in Groovy", showGroovyDuke, removeGroovyDuke);
//    slide.enter("", showScalaDuke, removeScalaDuke);
//    slide.enter("", showScalaDuke, removeScalaDuke);
    slide.start({
        progressbar: true,
        duration: 10,
        progressPrecision: 5
    });
</script>

</body>
</html>