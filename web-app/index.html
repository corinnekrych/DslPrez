<!DOCTYPE html>
<html><head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>Groovy DSL</title>
    <meta name="description" content="The power of Groovy for DSL and User Interaction in this presentation">
    <meta name="author" content="Corinne Krych, Sebastien Blanc, Fabrice Matrat">
    <link rel="shortcut icon" href="img/icon.ico" type="image/x-icon">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/grails.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/grails.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/grails.png">
    <link rel="apple-touch-icon-precomposed" href="img/grails.png">
    <link rel="stylesheet" href="css/codemirror.css">
    <link rel="stylesheet" href="css/eclipse.css">
    <link href="css/bootstrap.css" rel="stylesheet">
    <link href="css/bootstrap-responsive.css" rel="stylesheet">
    <link href="css/jqcloud.css" rel="stylesheet">
    <link href="css/prez.css" media="all" rel="stylesheet">
</head>
<body>
<div id="header" >
    <div style="float:left">
        <a href="http://groovy.codehaus.org">
            <table><tr><td style="vertical-align:middle;"><img  src="img/turtle1.png" style="height:35px"/></td><td > </td></tr></table>
        </a>
    </div>
    <div style="display: inline-block; margin:0 auto;">
        <a id="currentTitle" style="font-size:20px;" href="https://github.com/corinnekrych/Gr8ConfUS">Groovy DSL for Kids</a>
    </div>
    <div style="float:right">
        <a href="http://grails.org">
            <table><tr><td style="vertical-align: middle; "> </td><td><img src="img/turtle2.png" style="height:35px"/></td></tr></table>
        </a>
    </div>
</div>
<div style="overflow: hidden;" id="wrapper">
<ul>
<li class="slide"  title="">

    <div class="container-narrow">
        <hr>

        <div class="jumbotron" style="font-family: fantasy">
            <h1>Groovy DSL for kids</h1>
        </div>

        <hr>
        <div class="row-fluid marketing">
            <div class="span6">
                <p><img width="20%" src="img/corinne_krych.png"/></p>
                <h4>Corinne Krych</h4>
            </div>

            <div class="span6">
                <p><img width="20%" src="img/fabrice.png"/></p>
                <h4>Fabrice Matrat</h4>
            </div>
        </div>
        <hr>

        <div class="jumbotron">
            <p>to run this presentation: be full screen </p>
            <p>to submit the editor code to Grails app: ctrl S (command S on Mac)</p>
            <p>be careful using 1,2,3... it makes code snippet appears in the editor(focus must be inside editor)</p>
        </div>
        <hr>
        <div>
            <p style=""><img width="30%" src="img/gr8uslogo_with_tagline.png"/></p>
        </div>

        <canvas id="animationcanvas" width="1000" height="1000" ></canvas>
        <code style="visibility: hidden;" id="animationcontent" class="language-javascript">var f = true;
            function animate() { f = !f;
            moveObject('franklin', {
            role: 'turtle1', y: 9,
            x: f ? 8 : 1,
            rotation: 0
            }, animate);

            }
            animate();</pre></code>

        <script>
            (function () {
                var canvas = document.getElementById('animationcanvas');
                var ctx = canvas.getContext('2d');
                var grid = 10;
                ctx.scale(canvas.width / grid, canvas.height / grid);
                ctx.translate(1/2, 1/2);

                function drawGrid() {
                    for (var i = 0; i < grid; i++) {
                        for (var j = 0; j < grid; j++) {
                            ctx.beginPath();
                            ctx.lineWidth = 0.01;
                            ctx.strokeStyle = 'green';
                            ctx.moveTo(i, 0);
                            ctx.lineTo(i, grid - 1);
                            ctx.moveTo(0, j);
                            ctx.lineTo(grid - 1, j);
                            ctx.stroke();
                        }
                    }
                }

                var images = {};
                function draw(place) {
                    if (!images[place.role]) {
                        images[place.role] = new Image();
                        images[place.role].src = 'img/' + place.role + '.png';
                    }
                    ctx.save();
                    ctx.translate(place.x, grid - 1 - place.y);
                    ctx.rotate(- place.rotation);
                    ctx.drawImage(images[place.role], -1/2, -1/2, 1, 1);
                    ctx.restore();
                }

                function average(from, to, progress) {
                    return from + (to - from) * progress;
                }

                var duration = 7000;
                var current = {};
                var animated = {};
                function animate() {
                    var name;
                    var cont = false;
                    ctx.clearRect(-1, -1, grid + 1, grid + 1);
                    //drawGrid();
                    for (name in animated) {
                        if (animated.hasOwnProperty(name)) {
                            var to = animated[name];
                            var from = current[name];
                            var progress = (Date.now() - to.startTime) / duration;
                            if (progress > 1) {
                                current[name] = {
                                    role: to.role,
                                    x: to.x,
                                    y: to.y,
                                    rotation: to.rotation
                                };
                                delete animated[name];
                                if (to.cb) {
                                    to.cb();
                                }
                            } else {
                                cont = true;
                                draw({
                                    role: to.role,
                                    x: average(from.x, to.x, progress),
                                    y: average(from.y, to.y, progress),
                                    rotation: average(from.rotation, to.rotation, progress)
                                });
                            }
                        }
                    }
                    for (name in current) {
                        if (current.hasOwnProperty(name) && !animated[name]) {
                            draw(current[name]);
                        }
                    }
                    if (cont) {
                        setTimeout(animate, 1000 / 60);
                    }
                }

                function moveObject(name, object, callback) {
                    if (!current[name]) {
                        current[name] = object;
                        animate();
                        callback();
                    } else {
                        object.startTime = Date.now();
                        object.cb = callback;
                        animated[name] = object;
                        animate();
                    }
                }
                eval('(function() {' + document.getElementById('animationcontent').innerHTML + '}())');
            })();
        </script>

    </div>
</li>

<li class="slide" title="Corinne">
    <div class="container-narrow">
        <hr>

        <div class="jumbotron">
            <h1>Ladies first : Corinne</h1><br/>
            <img width="20%" src="img/corinne_krych.png"/><br/>
        </div>

        <hr>

        <div class="row-fluid marketing">
            <div class="span4">
                <a href="https://twitter.com/corinnekrych"><img src="img/twitter.png" /></a>
                <h4>@corinnekrych</h4>
            </div>
            <div class="span4">
                <a href="https://github.com/corinnekrych"><img src="img/github.png"/></a>
                <h4>https://github.com/corinnekrych</h4>
            </div>
            <div class="span4">
                <a href="mailto:corinnekrych@gmail.com"><img width="24px" src="img/gmail.png" ></a>
                <h4>corinnekrych@gmail.com</h4>
            </div>
        </div>

        <br/>
        <div style="float: left; font-size: 25px; text-align: left; display: inline-block; width: 16%">
            <img src="img/rivierargug.png" width="100%"/>
        </div>
        <div style="float:left;text-align:left;display:inline-block;width: 16%">
            <img src="img/3musket33rs.jpeg" width="100%"/>
        </div>

        <div style="float: left; font-size: 25px; text-align: left; display: inline-block; width: 16%">
            <img src="img/js-sophia-small.png" width="100%"/>
        </div>

        <div style="float: right; font-size: 25px; text-align: left; display: inline-block; width: 16%">
            <img src="img/logo_duchess_all_in_one_small.png" width="100%"/>
        </div>
        <div style="float:right;text-align:right;display:inline-block;width: 16%">
            <img src="img/aerogear.png" width="100%"/>
        </div>
        <div style="float:right;text-align:right;display:inline-block;width: 16%">
            <img src="img/redhat-logo-cloud.jpeg" width="90%"/>
        </div>
    </div>
</li>

<li class="slide" title="Fabrice">
    <div class="container-narrow">
        <hr>

        <div class="jumbotron">
            <h1>Fabrice : my geek husband</h1><br/>
            <img width="20%" src="img/fabrice.png"/><br/>
        </div>

        <hr>

        <div class="row-fluid marketing">
            <div class="span4">
                <a href="https://twitter.com/fabricematrat"><img src="img/twitter.png" /></a>
                <h4>@fabricematrat</h4>
            </div>
            <div class="span4">
                <a href="https://github.com/fabricematrat"><img src="img/github.png"/></a>
                <h4>https://github.com/fabricematrat</h4>
            </div>
            <div class="span4">
                <a href="mailto:fabricematrat@gmail.com"><img width="24px" src="img/gmail.png" ></a>
                <h4>fabricematrat@gmail.com</h4>
            </div>
        </div>
        <br/>
        <div style="width: 100%">
            <div style="float:left;text-align:right;display:inline-block;width: 30%">
                <img src="img/3musket33rs.jpeg" width="50%"/>
            </div>
            <div style="float:left;text-align:right;display:inline-block;width: 10%">
                &nbsp;
            </div>
            <div style="float: left; font-size: 25px; text-align: left; display: inline-block; width: 30%">
                <img src="img/rivierargug.png" width="50%"/>
            </div>
            <div style="float: left; font-size: 25px; text-align: left; display: inline-block; width: 30%">
                <img src="img/js-sophia-small.png" width="50%"/>
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Coming from...">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <h1>Kids <b>DSL</b>?</h1><br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span12">
                <h1>From</h1><br/>
                <div style="float: left; font-size: 25px; text-align: center; display: inline-block; width: 50%">
                    <img src="img/grails48.jpg" width="80%"/>
                </div>
                <div style="float: left; font-size: 25px; text-align: center; display: inline-block; width: 50%">
                    <img src="img/amadeus.jpg" width="80%"/>
                </div>
            </div>
        </div>
        <div class="jumbotron">
            <h1>To Kissing Turtles</h1><br/>
            <div style="float: left; font-size: 25px; text-align: center; display: inline-block; width: 50%">
                <img src="img/turtle1.png" width="40%"/>
            </div>
            <div style="float: left; font-size: 25px; text-align: center; display: inline-block; width: 50%">
                <img src="img/turtle2.png" width="40%"/>
            </div>
        </div>
    </div>
</li>

<li class="slide" title="DSL Definition">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <h1>WHAT IS A <b>DSL</b>?</h1><br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <p style="line-height: 150%;font-size: 35px"><strong>Domain-specific language</strong> (noun)</p>
                <p style="line-height: 150%;font-size: 30px" >a computer programming language of limited expressiveness focused on a particular domain</p>
                <h3>- Martin Fowler</h3>
            </div>
            <div class="span2">
            </div>
        </div>
        <!--<div class="row-fluid marketing">-->
            <!--<div class="span2">-->
            <!--</div>-->
            <!--<div class="span8">-->
                <!--<p style="line-height: 150%;font-size: 30px" >a language offering expressive power focused on a particular problem domain, such as a specific class of applications or application aspect</p>-->
                <!--<h3>- Czarnecki Krzysztof </h3>-->
            <!--</div>-->
            <!--<div class="span2">-->
            <!--</div>-->
        <!--</div>-->
    </div>
</li>

<li class="slide" title="Computer Language">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <pre style="font-size:16px;text-align:justify">
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
        10000110 10000000 11000000 00000101 10000110 10000000 11000000 00000101 10000110 10000000
        11000000 00000101 10000110 10000000 11000000 00000101 00000000 00000000 00000000 00010100
        00000000 00000000 00000000 00010100 10000110 10000000 11000000 00000101 10000110 10000000
            </pre>
        </div>
        <hr>
    </div>
</li>

<li class="slide" title="Computer Programming Language">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                    <pre class="code" style="line-height: 150%;font-size: 25px">
    <b class="code-color">SELECT</b> Bride
    <b class="code-color">FROM</b> SingleWomen
    <b class="code-color">WHERE</b> FatherInLaw = 'Millionaire'
    <b class="code-color">AND</b> Count(Car) > 20

    <b class="code-color">SELECT</b> Cash, Car, BankBalance
    <b class="code-color">FROM</b> FatherInLaw

    <b class="code-color">UPDATE</b> MyBankAccout
    <b class="code-color">SET</b> MyBal = MyBal + FatherInLawBal

    <b class="code-color">INSERT INTO</b> MyCarShed
    <b class="code-color">VALUES</b>('BMW')
                    </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Rubik Cube">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <img style="width:15%" src="img/cube_of_rubik_1.png"><br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <h1>RR U F B' RR F' B U RR</h1>
                    <pre class="code">
                    Terminology
                        F = front face
                        B = back face
                        R = right face
                        L = left face
                        U = up face
                        D = down face
                        A letter by itself means turn that face 90 degrees clockwise (eg. F)
                        A letter followed by an apostrophe means turn that face 90 degrees anti-clockwise (eg. F')
                    </pre>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Boundaries">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <br/>
            <h1 class="blur">Boundaries are blurry</h1><br/>
            <br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span4">
                <h1>Mini Language</h1>
                <hr>
                <pre class="code">prepare cake for tea</pre>
                <hr>
            </div>
            <div class="span4">
                <h1>Scripting</h1>
                <hr>
                <div> </div>
                <pre class="code">['cake', 'smoothie'].each{eat it}</pre>
                <hr>
            </div>
            <div class="span4">
                <h1>Fluent API</h1>
                <hr>
                <pre class="code">tea.willBe 45.minutes.from.now</pre>
                <hr>
            </div>
        </div>
    </div>
</li>

<li class="slide" title="Ext. vs int.">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <br/>
            <h1 >External vs Internal DSL</h1><br/>
            <br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span6">
                <h1>External</h1>
                <img width="97%" src="img/pix.jpeg">
            </div>
            <div class="span6">
                <h1>Internal</h1>
                <pre style="text-align: left;white-space: pre;font-size: 16px">
<b style="color:#AF956F;">class</b> HelloSpock <b style="color:#AF956F;">extends</b> Specification {
 <b style="color:#AF956F;">def</b> <b style="color:#5D90CD;">"Spock's and his friends' names length"</b>() {
  expect:
   name.size() == length

   where:
    name     | length
    <b style="color:#5D90CD;">"Spock"</b>  | <b style="color:#46A609;">5</b>
    <b style="color:#5D90CD;">"Kirk"</b>   | <b style="color:#46A609;">4</b>
    <b style="color:#5D90CD;">"Scotty"</b> | <b style="color:#46A609;">6</b>
  }
}
                </pre>
            </div>
        </div>
    </div>
</li>
<li class="slide" title="Groovy">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span8" style="height:600px;width:100%;" id="wordcloud">
            </div>
        </div>
    </div>
</li>

<li class="slide" title="DSL & Game">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <br/>
            <h1>Game rules & DSL</h1><br/>
            <br/>
        </div>
        <hr>
        <div class="row-fluid marketing">
            <div class="span6">
                <h1>User1: Franklin</h1>
                <hr>
                <pre class="code">move left by 2.steps
move up by 3.steps
</pre>
                <hr>
            </div>
            <div class="span6">
                <h1>User2: Emily</h1>
                <hr>
                <div> </div>
                <pre class="code">move left by 2.steps
ask "What's is your name?" assign to name
</pre>
                <hr>
            </div>

        </div>
    </div>
</li>

<!------------------------------------------------------------------->
<!-- 1. Script
<!-- step 1 define base class
<!-- step 2 remove move definition in script
<!------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="First Script" press="Press 1..2">
    <textarea id="editor1" name="editor1">
// Configure the GroovyShell.
def shell = new GroovyShell()

///////////////////////
def gameDSL = '''
'''
//////////////////////
// Run DSL script.
def result = shell.evaluate gameDSL</textarea>
</li>

<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="output" id="output1">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!------------------------------------------------------------------->
<!-- 2. Base Class
<!-- step 1 define base class
<!-- step 2 remove move definition in script
<!-- step 3 introduce compilerConfiguration
<!-- step 4 inject it in groovy shell
<!------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="Base class" press="Press 1..5">
    <textarea id="editor2" name="editor2">
// Configure the GroovyShell.
def shell = new GroovyShell()

///////////////////////
def gameDSL = '''
def move(direction) {
  println "moving $direction"
}
def left = "left"
move left

'''
//////////////////////
// Run DSL script.
def result = shell.evaluate gameDSL
    </textarea>
</li>

<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="output2">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!------------------------------------------------------------------->
<!-- 3. Binding
<!-- step 1 introduce right in binding
<!-- step 2 ad move right command
<!------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="Binding" press="Press 1..2">
    <textarea id="editor3" name="editor3">
// Configure the GroovyShell.
abstract class GameScript extends Script {
  def move = {direction -> println "moving $direction" }
  def left = "left"
}
def compilerConfig = new CompilerConfiguration()
compilerConfig.scriptBaseClass = GameScript.class.name
def binding = new Binding()
def shell = new GroovyShell(this.class.classLoader,
        binding,
        compilerConfig)
///////////////////////
def gameDSL = '''
move left
'''
//////////////////////
// Run DSL script.
def result = shell.evaluate gameDSL
    </textarea>
</li>

<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="output3">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!------------------------------------------------------------------->
<!-- 4. Add turtle: Structure my code
<!-- step 1 Position
<!-- step 2 Direction
<!-- step 3 Turtle
<!-- step4 inject binding, remove def left in GameScript
<!-- step5 replace inheritance by binding
<!------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="Add Turtle class" press="Press 1..8">
    <textarea id="editor4" name="editor4">
// Configure the GroovyShell.
abstract class GameScript extends Script {
  def move = {direction -> println "moving $direction" }
  def left = "left"
}
def compilerConfig = new CompilerConfiguration()
compilerConfig.scriptBaseClass = GameScript.class.name
def binding = new Binding([right:"right"])
def shell = new GroovyShell(this.class.classLoader,
        binding,
        compilerConfig)
///////////////////////
def gameDSL = '''
move left
move right
'''
//////////////////////
// Run DSL script.
def result = shell.evaluate gameDSL
    </textarea>
</li>

<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="output4">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!------------------------------------------------------------------->
<!-- 5. Building JSON
<!-- step 1 use steps instead println
<!-- step 2 after eval get value of steps
<!-- step 3 jsonbuilder
<!-- step 4 up the stairs
<!-- cmd-S for text output cmd-D for canvas output
<!------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="Building JSON for HTML5 display" press="Press 1..7">
    <textarea id="editor5" name="editor5">
class Position {
  int x
  int y
  Position left() {
     new Position(x - 1, y);
  }
  Position right() {
    new Position(x + 1 , y);
  }
  Position up() {
    new Position(x , y + 1);
  }
  Position down() {
    new Position(x , y - 1);
  }
  def Position(moveX, moveY) {
     x = moveX
     y = moveY
  }
}

class Turtle {
   def currentPosition

   Turtle(Position start) {
      currentPosition = start

   }

   Turtle move(Direction dir) {
      Position newPosition
      if (dir == Direction.left) {
        newPosition = currentPosition.left()
      } else if (dir == Direction.right) {
        newPosition = currentPosition.right()
      } else if (dir == Direction.up) {
        newPosition = currentPosition.up()
      } else if (dir == Direction.down) {
        newPosition = currentPosition.down()
      }
      currentPosition = newPosition
      println "x = $currentPosition.x and y = $currentPosition.y"

      this
   }
}
enum Direction {
  left, right, up, down
}


def turtle = new Turtle(new Position(1, 1))
def compilerConfig = new CompilerConfiguration()
def binding = new Binding([turtle: turtle,
  						   move: turtle.&move,
                           left: Direction.left,
                           right: Direction.right,
                           up: Direction.up,
                           down: Direction.down])
def shell = new GroovyShell(this.class.classLoader,
        binding,
        compilerConfig)
///////////////////////
def gameDSL = '''

  move right
  move up

'''
//////////////////////
// Run DSL script.
// result contains turtle object
// with all steps
shell.evaluate gameDSL











</textarea>
</li>

<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="output5">
                </pre>
                <canvas id="canvas5" width="1000" height="1000" style="max-width: 500px; width: 100%;"></canvas>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!------------------------------------------------------------------->
<!-- slide command chaining
<!------------------------------------------------------------------->
<li class="slide" title="Command Chaining">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <br/>
            <h1>Command chaining</h1><br/>
            <br/>
        </div>
        <hr>
    </div>
    <div class="row-fluid marketing">
        <div class="span2">
        </div>
        <div class="span8">
            <p style="line-height:150%; font-size:25px;font-style:italic"><strong>Method chaining</strong> is a common technique for invoking multiple method calls in object-oriented programming languages. Each method returns an object (possibly the current object itself), allowing the calls to be chained together in a single statement.</p>
            <div style="line-height:150%; font-size:20px;" class="general quote-author">- wikipedia</div>
        </div>
        <div class="span2">
        </div>
    </div>
    <div class="row-fluid marketing">
        <div class="span1">
        </div>
        <div class="span5">
            <hr>
            <div style="line-height:150%;font-size:25px;text-align:left;">
                <div style="color:grey"> move left</div>
                <div>    => move(left)</div>
            </div>
            <hr>
        </div>
        <div class="span5">
            <hr>
            <div style="line-height:150%;font-size:25px;text-align:left;">
                <div style="color:grey">move left by 2</div>
                <div>    => move(left).by(2)</div>
            </div>
            <hr>
        </div>
        <div class="span1">
        </div>
    </div>
</li>

<!-------------------------------------------------------------------
6. Command chaining odd number
step 1: highlight dsl syntax
step 2: move left by 2
step 3: add by method
step 4: highlight steps.add from turtle move
step 5: remove steps.add from turtle mve
step 6: add steps.add to turtle by
step 7: change new Position to add direction
------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="Command Chaining" press="Press 1..7">
    <textarea id="editor6" name="editor6">
class Position {
  int x
  int y
  Direction direction
  Position left() {
     new Position(x, y, Direction.left);
  }
  Position right() {
    new Position(x, y, Direction.right);
  }
  Position up() {
    new Position(x , y, Direction.up);
  }
  Position down() {
    new Position(x , y, Direction.down);
  }
  def Position(moveX, moveY, myDirection) {
    x = moveX
    y = moveY
    direction = myDirection
  }
  Position move(Integer step) {
    Position newPosition
    if(direction == Direction.left) {
      newPosition = new Position(x - step, y, direction)
    } else if(direction == Direction.right) {
      newPosition = new Position(x + step, y, direction)
    } else if(direction == Direction.up) {
      newPosition = new Position(x, y + step, direction)
    } else if(direction == Direction.down) {
      newPosition = new Position(x, y - step, direction)
    }
  }
}

class Turtle {
   def currentPosition
   def steps = []
   Turtle(Position start) {
      currentPosition = start
      steps.add(start)
   }

   Turtle move(Direction dir) {
      Position newPosition
      if (dir == Direction.left) {
        newPosition = currentPosition.left()
      } else if (dir == Direction.right) {
        newPosition = currentPosition.right()
      } else if (dir == Direction.up) {
        newPosition = currentPosition.up()
      } else if (dir == Direction.down) {
        newPosition = currentPosition.down()
      }
      currentPosition = newPosition
      steps.add(newPosition)
      this
   }

}
enum Direction {
  left, right, up, down
}


def turtle = new Turtle(new Position(1, 1))
def compilerConfig = new CompilerConfiguration()
def binding = new Binding([turtle: turtle,
  						   move: turtle.&move,
                           left: Direction.left,
                           right: Direction.right,
                           up: Direction.up,
                           down: Direction.down])
def shell = new GroovyShell(this.class.classLoader,
        binding,
        compilerConfig)
///////////////////////
def gameDSL = '''
2.times {
  move right
  move up
}
'''
//////////////////////
// Run DSL script.
// result contains turtle object
// with all steps
shell.evaluate gameDSL
def builder = new groovy.json.JsonBuilder()
builder {
   steps binding["turtle"].steps
}
println builder
builder.toString()
    </textarea>
</li>


<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="output6">
                </pre>
                <canvas id="canvas6" width="1000" height="1000" style="max-width: 500px; width: 100%;"></canvas>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>
<!------------------------------------------------------------------->
<!-- slide Back to command chaining
<!------------------------------------------------------------------->
<li class="slide" title="Back to Command Chaining">
    <div class="container-narrow">
        <hr>
        <div class="jumbotron">
            <br/>
            <h1>Command chaining</h1><br/>
            <br/>
        </div>
        <hr>
    </div>

    <div class="row-fluid marketing">
        <div class="span1">
        </div>
        <div class="span5">
            <hr>
            <div style="line-height:150%;font-size:25px;text-align:left;">
                <div style="color:grey"> move left by 2</div>
                <div>    => move(left).by(2)</div>
            </div>
            <hr>
        </div>
        <div class="span5">
            <hr>
            <div style="line-height:150%;font-size:25px;text-align:left;">
                <div style="color:grey"> move left by 2 steps</div>
                <div>    => move(left).by(2).steps</div>
            </div>
            <hr>
        </div>
        <div class="span1">
        </div>
    </div>
</li>
<!-------------------------------------------------------------------
6b. Command chaining odd number
step 1: highlight dsl syntax
step 2: move left by 2 steps
step 3: highlight by method
step 4: change by method to return map
------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="Odd Command Chaining" press="Press 1..4">
    <textarea id="editor6b" name="editor6">
class Position {
  int x
  int y
  Direction direction
  Position left() {
     new Position(x, y, Direction.left);
  }
  Position right() {
    new Position(x, y, Direction.right);
  }
  Position up() {
    new Position(x , y, Direction.up);
  }
  Position down() {
    new Position(x , y, Direction.down);
  }
  def Position(moveX, moveY, myDirection) {
    x = moveX
    y = moveY
    direction = myDirection
  }
  Position move(Integer step) {
    Position newPosition
    if(direction == Direction.left) {
      newPosition = new Position(x - step, y, direction)
    } else if(direction == Direction.right) {
      newPosition = new Position(x + step, y, direction)
    } else if(direction == Direction.up) {
      newPosition = new Position(x, y + step, direction)
    } else if(direction == Direction.down) {
      newPosition = new Position(x, y - step, direction)
    }
  }
}

class Turtle {
   def currentPosition
   def steps = []
   Turtle(Position start) {
      currentPosition = start
      steps.add(start)
   }

   Turtle move(Direction dir) {
      Position newPosition
      if (dir == Direction.left) {
        newPosition = currentPosition.left()
      } else if (dir == Direction.right) {
        newPosition = currentPosition.right()
      } else if (dir == Direction.up) {
        newPosition = currentPosition.up()
      } else if (dir == Direction.down) {
        newPosition = currentPosition.down()
      }
      currentPosition = newPosition
      this
   }

  Turtle by (Integer step) {
    Position newPosition = currentPosition.move(step)
    steps.add(newPosition)
    currentPosition = newPosition
    steps.add(newPosition)
    this
  }
}
enum Direction {
  left, right, up, down
}

def turtle = new Turtle(new Position(1, 1, Direction.left))
def compilerConfig = new CompilerConfiguration()
def binding = new Binding([turtle: turtle,
  						   move: turtle.&move,
                           left: Direction.left,
                           right: Direction.right,
                           up: Direction.up,
                           down: Direction.down])
def shell = new GroovyShell(this.class.classLoader,
        binding,
        compilerConfig)
///////////////////////
def gameDSL = '''
2.times {
    move right by 2
    move up by 1
}
'''
//////////////////////
// Run DSL script.
// result contains turtle object
// with all steps
shell.evaluate gameDSL
def builder = new groovy.json.JsonBuilder()
builder {
   steps binding["turtle"].steps
}
println builder
builder.toString()
    </textarea>
</li>


<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="output6b">
                </pre>
                <canvas id="canvas6b" width="1000" height="1000" style="max-width: 500px; width: 100%;"></canvas>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!-------------------------------------------------------------------
7. Adding behavior to Integer
step1: highlight dsl
step2: move left by 2.steps
step3: add class StepCategory
step4: highlight shell.eval
step5: modify shell.eval with use()
step6: highlight class StepCategory
step7: replace with @Category annotation
------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="Adding behavior to Integer" press="Press 1..7">
    <textarea id="editor7" name="editor7">
class Position {
  int x
  int y
  Direction direction
  Position left() {
     new Position(x, y, Direction.left);
  }
  Position right() {
    new Position(x, y, Direction.right);
  }
  Position up() {
    new Position(x , y, Direction.up);
  }
  Position down() {
    new Position(x , y, Direction.down);
  }
  def Position(moveX, moveY, myDirection) {
    x = moveX
    y = moveY
    direction = myDirection
  }
  Position move(Integer step) {
    Position newPosition
    if(direction == Direction.left) {
      newPosition = new Position(x - step, y, direction)
    } else if(direction == Direction.right) {
      newPosition = new Position(x + step, y, direction)
    } else if(direction == Direction.up) {
      newPosition = new Position(x, y + step, direction)
    } else if(direction == Direction.down) {
      newPosition = new Position(x, y - step, direction)
    }
  }
}

class Turtle {
  def currentPosition
  def steps = []
  Turtle(Position start) {
    currentPosition = start
    steps.add(start)
  }

  Turtle move(Direction dir) {
    Position newPosition
    if (dir == Direction.left) {
      newPosition = currentPosition.left()
    } else if (dir == Direction.right) {
      newPosition = currentPosition.right()
    } else if (dir == Direction.up) {
      newPosition = currentPosition.up()
    } else if (dir == Direction.down) {
      newPosition = currentPosition.down()
    }
    currentPosition = newPosition
    this
  }

  Turtle by (Integer step) {
    Position newPosition = currentPosition.move(step)
    steps.add(newPosition)
    currentPosition = newPosition
    this
  }
}
enum Direction {
  left, right, up, down
}


def turtle = new Turtle(new Position(1, 1, Direction.left))
def compilerConfig = new CompilerConfiguration()
def binding = new Binding([turtle: turtle,
  						   move: turtle.&move,
                           left: Direction.left,
                           right: Direction.right,
                           up: Direction.up,
                           down: Direction.down])
def shell = new GroovyShell(this.class.classLoader,
        binding,
        compilerConfig)
///////////////////////
def gameDSL = '''
2.times {
  move right by 2
  move up by 1
}
'''
//////////////////////
// Run DSL script.
// result contains turtle object
// with all steps
shell.evaluate gameDSL
def builder = new groovy.json.JsonBuilder()
builder {
   steps binding["turtle"].steps
}
println builder
builder.toString()

    </textarea>
</li>


<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="output7">
                </pre>
                <canvas id="canvas7" width="1000" height="1000" style="max-width: 500px; width: 100%;"></canvas>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!-------------------------------------------------------------------
8. TypeChecked
step 1: highlight compiler
step 2: add typechecked ext
<!------------------------------------------------------------------->
<li class="slide" style="text-align: left" title="TypeChecked" press="Press 1..2">
    <textarea id="editor8" name="editor8">
class Position {
    int x
    int y
    Direction direction
    Position left() {
        new Position(x, y, Direction.left);
    }
    Position right() {
        new Position(x, y, Direction.right);
    }
    Position up() {
        new Position(x , y, Direction.up);
    }
    Position down() {
        new Position(x , y, Direction.down);
    }
    def Position(moveX, moveY, myDirection) {
        x = moveX
        y = moveY
        direction = myDirection
    }
    Position move(Integer step) {
        Position newPosition
        if(direction == Direction.left) {
            newPosition = new Position(x - step, y, direction)
        } else if(direction == Direction.right) {
            newPosition = new Position(x + step, y, direction)
        } else if(direction == Direction.up) {
            newPosition = new Position(x, y + step, direction)
        } else if(direction == Direction.down) {
            newPosition = new Position(x, y - step, direction)
        }
    }
}

class Turtle {
    def currentPosition
    def steps = []
    Turtle(Position start) {
        currentPosition = start
        steps.add(start)
    }

    Turtle move(Direction dir) {
        Position newPosition
        if (dir == Direction.left) {
            newPosition = currentPosition.left()
        } else if (dir == Direction.right) {
            newPosition = currentPosition.right()
        } else if (dir == Direction.up) {
            newPosition = currentPosition.up()
        } else if (dir == Direction.down) {
            newPosition = currentPosition.down()
        }
        currentPosition = newPosition
        this
    }

    Turtle by (Integer step) {
        Position newPosition = currentPosition.move(step)
        steps.add(newPosition)
        currentPosition = newPosition
        this
    }
}

enum Direction {
    left, right, up, down
}


def turtle = new Turtle(new Position(1, 1, Direction.left))

def binding = new Binding([turtle: turtle,
    move: turtle.&move,
    left: Direction.left,
    right: Direction.right,
    up: Direction.up,
    down: Direction.down])

def compilerConfig = new CompilerConfiguration()

def shell = new GroovyShell(this.class.classLoader,
    binding,
    compilerConfig)
///////////////////////
def gameDSL = '''
moooooooooove right by 2
move up by 3
'''
//////////////////////
// Run DSL script.
// result contains turtle object
// with all steps
shell.evaluate gameDSL

def builder = new groovy.json.JsonBuilder()
builder {
    steps binding["turtle"].steps
}
println builder
builder.toString()


    </textarea>
</li>


<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="output8">
                </pre>
                <canvas id="canvas8" width="1000" height="1000" style="max-width: 500px; width: 100%;"></canvas>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<!-------------------------------------------------------------------
9. Turn around
step1: highlight dsl
step2: modify dsl with infinite loop
step3: highlight ASTTransformationCustomizer
step4: add TimeInterrupt
------------------------------------------------------------------->

<li class="slide" style="text-align: left" title="Franklin wants to turn around" press="Press 1..4">
    <textarea id="editor9" name="editor9">
class Position {
    int x
    int y
    Direction direction
    Position left() {
        new Position(x, y, Direction.left);
    }
    Position right() {
        new Position(x, y, Direction.right);
    }
    Position up() {
        new Position(x , y, Direction.up);
    }
    Position down() {
        new Position(x , y, Direction.down);
    }
    def Position(moveX, moveY, myDirection) {
        x = moveX
        y = moveY
        direction = myDirection
    }
    Position move(Integer step) {
        Position newPosition
        if(direction == Direction.left) {
            newPosition = new Position(x - step, y, direction)
        } else if(direction == Direction.right) {
            newPosition = new Position(x + step, y, direction)
        } else if(direction == Direction.up) {
            newPosition = new Position(x, y + step, direction)
        } else if(direction == Direction.down) {
            newPosition = new Position(x, y - step, direction)
        }
    }
}

class Turtle {
    def currentPosition
    def steps = []
    Turtle(Position start) {
        currentPosition = start
        steps.add(start)
    }

    Turtle move(Direction dir) {
        Position newPosition
        if (dir == Direction.left) {
            newPosition = currentPosition.left()
        } else if (dir == Direction.right) {
            newPosition = currentPosition.right()
        } else if (dir == Direction.up) {
            newPosition = currentPosition.up()
        } else if (dir == Direction.down) {
            newPosition = currentPosition.down()
        }
        currentPosition = newPosition
        this
    }

    Turtle by (Integer step) {
        Position newPosition = currentPosition.move(step)
        steps.add(newPosition)
        currentPosition = newPosition
        this
    }
}

enum Direction {
    left, right, up, down
}


def turtle = new Turtle(new Position(1, 1, Direction.left))

def binding = new Binding([turtle: turtle,
    move: turtle.&move,
    left: Direction.left,
    right: Direction.right,
    up: Direction.up,
    down: Direction.down])

def compilerConfig = new CompilerConfiguration()

compilerConfig.addCompilationCustomizers(
    new ASTTransformationCustomizer(TypeChecked, extensions:['TurtleExtension.groovy']))

def shell = new GroovyShell(this.class.classLoader,
    binding,
    compilerConfig)
///////////////////////
def gameDSL = '''

    move right by 2
    move up by 2
    move right by 2
    move up by 2

'''
//////////////////////
// Run DSL script.
// result contains turtle object
// with all steps
shell.evaluate gameDSL

def builder = new groovy.json.JsonBuilder()
builder {
    steps binding["turtle"].steps
}
println builder
builder.toString()
    </textarea>
</li>

<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="output9">
                </pre>
                <canvas id="canvas9" width="1000" height="1000" style="max-width: 500px; width: 100%;"></canvas>
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>


<!-------------------------------------------------------------------
10. Sneaky
step 1: highlight dsl
step 2: add system.exit
step 3: add SecureASTCustomizer
------------------------------------------------------------------->

<li class="slide" style="text-align: left" title="Franklin wants to play with fire" press="Press 1..3">
    <textarea id="editor10" name="editor10">
class Position {
    int x
    int y
    Direction direction
    Position left() {
        new Position(x, y, Direction.left);
    }
    Position right() {
        new Position(x, y, Direction.right);
    }
    Position up() {
        new Position(x , y, Direction.up);
    }
    Position down() {
        new Position(x , y, Direction.down);
    }
    def Position(moveX, moveY, myDirection) {
        x = moveX
        y = moveY
        direction = myDirection
    }
    Position move(Integer step) {
        Position newPosition
        if(direction == Direction.left) {
            newPosition = new Position(x - step, y, direction)
        } else if(direction == Direction.right) {
            newPosition = new Position(x + step, y, direction)
        } else if(direction == Direction.up) {
            newPosition = new Position(x, y + step, direction)
        } else if(direction == Direction.down) {
            newPosition = new Position(x, y - step, direction)
        }
    }
}

class Turtle {
    def currentPosition
    def steps = []
    Turtle(Position start) {
        currentPosition = start
        steps.add(start)
    }

    Turtle move(Direction dir) {
        Position newPosition
        if (dir == Direction.left) {
            newPosition = currentPosition.left()
        } else if (dir == Direction.right) {
            newPosition = currentPosition.right()
        } else if (dir == Direction.up) {
            newPosition = currentPosition.up()
        } else if (dir == Direction.down) {
            newPosition = currentPosition.down()
        }
        currentPosition = newPosition
        this
    }

    Turtle by (Integer step) {
        Position newPosition = currentPosition.move(step)
        steps.add(newPosition)
        currentPosition = newPosition
        this
    }
}

enum Direction {
    left, right, up, down
}


def turtle = new Turtle(new Position(1, 1, Direction.left))

def binding = new Binding([turtle: turtle,
    move: turtle.&move,
    left: Direction.left,
    right: Direction.right,
    up: Direction.up,
    down: Direction.down])

def compilerConfig = new CompilerConfiguration()

def tc = new ASTTransformationCustomizer(TypeChecked, extensions:['TurtleExtension.groovy'])
def ti = new ASTTransformationCustomizer([value:5L], TimedInterrupt)

compilerConfig.addCompilationCustomizers(tc, ti)

def shell = new GroovyShell(this.class.classLoader,
    binding,
    compilerConfig)
///////////////////////
def gameDSL = '''
    move right by 2
    move up by 2
    move left by 2
    move down by 2

'''
//////////////////////
// Run DSL script.
// result contains turtle object
// with all steps
shell.evaluate gameDSL

def builder = new groovy.json.JsonBuilder()
builder {
    steps binding["turtle"].steps
}
println builder
builder.toString()
    </textarea>
</li>

<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="code" id="output10">
                </pre>
                <canvas id="canvas10" width="1000" height="1000" style="max-width: 500px; width: 100%;"></canvas>
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>


<!-------------------------------------------------------------------
11.ask
step1: insert DSL ask
step2: add ask method
step3: add propertyMissingMethod
step4: add display map method
step5: add display map in DSL
------------------------------------------------------------------->

<li class="slide" style="text-align: left" title="Franklin wants to ask" press="Press 1..5">
    <textarea id="editor11" name="editor9">
abstract class GameScript extends Script {


}
def compilerConfig = new CompilerConfiguration()
compilerConfig.scriptBaseClass = GameScript.class.name
def binding = new Binding()
def shell = new GroovyShell(this.class.classLoader,
                            binding,
                            compilerConfig)
///////////////////////
def surveyDSL = '''

'''
//////////////////////
// Run DSL script.
shell.evaluate surveyDSL
    </textarea>
</li>

<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="output" id="output11">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>

<li class="slide" title="DSL Sequence">
    <div class="row-fluid marketing">
        <div class="span12">
            <img src="img/ask and ast.png" width="80%"/>
        </div>
    </div>
</li>

<!------------------------------------------------------------------->
<!-- 12. AST for user transform
<!------------------------------------------------------------------->

<li class="slide" style="text-align: left" title="AST Tranformation" press="">
    <textarea id="editor12" name="editor12">
def getShell(binding) {
  def config = new CompilerConfiguration()
  config.addCompilationCustomizers(new SurveyCustomizer())
  config.scriptBaseClass = SurveyScript.name
  new GroovyShell(this.class.classLoader,
                  binding,
                  config)
}
def binding = new Binding()
def inputs = [:]
binding.setVariable("inputs", inputs)
def script = """
ask "what's your name?" assign to name
ask "what's your birthday?" assign to date
"""
//first evaluate should run only the first ask
getShell(binding).evaluate script
//second evaluate should run only the second ask2
getShell(binding).evaluate script


abstract class SurveyScript extends Script {
  def ask(question) {
    [assign : { to ->
      [:].withDefault {assignment ->
        inputs.question = question
        inputs.lastAssignment = assignment
        println "ask called\n --> counter: $inputs.counter \n" +
        "--> question: $question\n" +
        "--> variables: $inputs.lastAssignment\n" +
        "______________________________________\n"
        inputs.counter++
      }
    }]
  }

  def propertyMissing(String name) {
    name
  }

  //entry point method each time the script is called
  void dispatch() {
    if(!inputs.answerMap){
      inputs.answerMap = [:]
    }
    if(!inputs.counter){
      inputs.counter=0
    }
    inputs.answerMap[inputs.counter] =
      [variable:inputs.lastAssignment,
       question:inputs.question,
       answer:inputs.answer]
    invokeMethod()
  }

  def invokeMethod() {
    try {
      def method =
      this.class.getMethod("doStep_${inputs.counter}")
      method.invoke(this)
    }
    catch(NoSuchMethodException exp){
      inputs.finished = true
    }
  }
}

public class SurveyCustomizer extends CompilationCustomizer {
  def step = 0

  public SurveyCustomizer() {
    super(CompilePhase.CONVERSION);
  }

  @Override
  public void call(final SourceUnit source,
                   final GeneratorContext context,
                   final ClassNode classNode)
    throws CompilationFailedException {
    def methodCalls = []
    def ast = source.getAST();
    ast.classes.each {
      def myClassNode = it
      it.methods.each {
        if (it.code instanceof BlockStatement
          && it.name == "run") {
          it.code.statements.each {
            methodCalls << it
          }
          def result = new AstBuilder().buildFromCode {
            this.dispatch()
          }
          it.code = result[0];
        }
      }
      methodCalls.each {
        addStatement(it, myClassNode)
      }
    }
  }

  private def addStatement(ExpressionStatement exprStmt,
                           myClassNode) {
    BlockStatement methodCodeBlock = new BlockStatement()
    methodCodeBlock.addStatement(exprStmt)
    myClassNode.addMethod("doStep_" + step,
                          1,
                          null,
                          [] as Parameter[],
                          [] as ClassNode[],
                          methodCodeBlock)
    step++
  }
}
    </textarea>
</li>

<li class="slide" style="text-align: left" title="">
    <div class="container-narrow">
        <div class="row-fluid marketing">
            <div class="span2">
            </div>
            <div class="span8">
                <hr>
                <pre class="output" id="output12">
                </pre>
                <hr>
            </div>
            <div class="span2">
            </div>
        </div>
    </div>
</li>


<!------------------------------------------------------------------->
<!-- 12. References
<!------------------------------------------------------------------->

<li class="slide" title="References">
    <div class="container-narrow">
        <hr>

        <div style="text-align: center" class="jumbotron">
            <img width="20%" src="img/rivierargug.png"/><br/>
        </div>

        <hr>

        <div  class="row-fluid marketing">
            <div class="span1">
            </div>
            <div class="span5">
                <div style="line-height: 150%;font-size:30px;font-weight:bold">Like the presentation format?</div>
                <div id="technologies" style="line-height: 150%;font-size:30px;"></div>

                <div style="line-height: 150%;font-size:30px;font-weight:bold">Curious about code?</div>
                <a href="https://github.com/corinnekrych/Gr8ConfUS" style="line-height: 150%;font-size:20px;">https://github.com/corinnekrych/Gr8ConfUS</a>

                <div style="line-height: 150%;font-size:30px;font-weight:bold">Want to play with it?</div>
                <a href='https://github.com/corinnekrych/KissingTurtles' style="line-height: 150%;font-size:20px;">https://github.com/corinnekrych/KissingTurtles</a>
            </div>
            <div class="span5">
                <div style="line-height: 150%;font-size:30px;font-weight:bold">Special Thanks</div>
                <div style="line-height: 150%;font-size:20px;">Mathieu Bruyen, Sebastien Blanc</div>
                <div style="line-height: 150%;font-size:30px;font-weight:bold">References</div>
                <div style="line-height: 150%;font-size:20px;">Domain-Specific Languages</div>
                <div style="line-height: 150%;font-size:20px;font-style:italic">Martin Fowler, with Rebecca Parsons</div>
                <div style="line-height: 150%;font-size:20px;">Groovy for Domain-Specific Languages  </div>
                <div style="line-height: 150%;font-size:20px;font-style:italic">Fergal Dearle</div>
                <div style="line-height: 150%;font-size:20px;">Groovy in Action</div>
                <div style="line-height: 150%;font-size:20px;font-style:italic">Guillaume Laforge, Paul King, Jon Skeet </div>
            </div>
            <div class="span1">
            </div>
        </div>
    </div>
</li>

</ul>
</div>
<div id="footer">
    <div style="float:left;">
        <a id="previous">
            <table><tr><td style="vertical-align:middle;"><img  src="img/previous.png" style="height:40px"/></td><td id="previous-title"> Previous</td></tr></table>
        </a>
    </div>

    <!--<div style="float:left;">-->
        <!--<a id="run">-->
            <!--<table><tr><td style="vertical-align:middle;"><img  src="img/grails4.png" style="height:40px"/></td></tr></table>-->
        <!--</a>-->
    <!--</div>-->


    <div style="display: inline-block; margin:0 auto;">
        <a id="currentPress" style="font-size:20px;"></a>
    </div>
    <div style="float:right;">
        <a id="next">
            <table><tr><td id="next-title" style="vertical-align: middle; ">Next</td><td><img src="img/next.png" style="height:40px"/></td></tr></table>
        </a>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script type="text/javascript" src="js/iscroll.js"></script>
<script src="js/codemirror.js"></script>
<script src="js/groovy.js"></script>

<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
<!--[if lt IE 9]>
<script src="js/html5.js">
</script>
<![endif]-->
<script src="js/bootstrap.js"></script>
<script src="js/editor.js"></script>
<script src="js/jquery.airport-1.1.source.js"></script>
<script src="js/jqcloud-1.0.2.min.js"></script>
<script src="js/prez.js"></script>
<script src="js/slide.js"></script>
<script src="js/ktDraw.js"></script>
</body>
</html>